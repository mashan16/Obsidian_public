---
tags:
  - public
  - linux
---

### –û–ø–∏—Å–∞–Ω–∏–µ
**Fail2Ban** ‚Äî —ç—Ç–æ —É—Ç–∏–ª–∏—Ç–∞ –¥–ª—è –ø–æ–≤—ã—à–µ–Ω–∏—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ —Å–µ—Ä–≤–µ—Ä–æ–≤, –∫–æ—Ç–æ—Ä–∞—è **–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –±–ª–æ–∫–∏—Ä—É–µ—Ç IP-–∞–¥—Ä–µ—Å–∞**, —Å–æ–≤–µ—Ä—à–∞—é—â–∏–µ –ø–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω—É—é –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å, –Ω–∞–ø—Ä–∏–º–µ—Ä:  
‚Äì –º–Ω–æ–≥–æ–∫—Ä–∞—Ç–Ω—ã–µ –Ω–µ—É–¥–∞—á–Ω—ã–µ –ø–æ–ø—ã—Ç–∫–∏ –≤—Ö–æ–¥–∞ –≤ —Å–∏—Å—Ç–µ–º—É,  
‚Äì –ø–µ—Ä–µ–±–æ—Ä –ø–∞—Ä–æ–ª–µ–π (brute-force),  
‚Äì –ø–æ–ø—ã—Ç–∫–∏ —ç–∫—Å–ø–ª—É–∞—Ç–∞—Ü–∏–∏ —É—è–∑–≤–∏–º–æ—Å—Ç–µ–π.
#### ‚öôÔ∏è –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç Fail2Ban:
1. **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ª–æ–≥–æ–≤**: Fail2Ban –∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç —Å–∏—Å—Ç–µ–º–Ω—ã–µ –∏ —Å–µ—Ä–≤–∏—Å–Ω—ã–µ –ª–æ–≥-—Ñ–∞–π–ª—ã (–Ω–∞–ø—Ä–∏–º–µ—Ä, `auth.log`, `mail.log`, `nginx/error.log`, `zimbra/mailbox.log` –∏ —Ç. –¥.).
    
2. **–ü–æ–∏—Å–∫ —à–∞–±–ª–æ–Ω–æ–≤ –æ—à–∏–±–æ–∫**: –û–Ω –∏—Å–ø–æ–ª—å–∑—É–µ—Ç _—Ä–µ–≥—É–ª—è—Ä–Ω—ã–µ –≤—ã—Ä–∞–∂–µ–Ω–∏—è_ –¥–ª—è –ø–æ–∏—Å–∫–∞ –∑–∞–ø–∏—Å–µ–π, —É–∫–∞–∑—ã–≤–∞—é—â–∏—Ö –Ω–∞ –Ω–µ—É–¥–∞—á–Ω—ã–µ –ø–æ–ø—ã—Ç–∫–∏ –≤—Ö–æ–¥–∞, –æ—à–∏–±–∫–∏ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ –∏ –¥—Ä—É–≥–∏–µ –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–µ –∞—Ç–∞–∫–∏.
    
3. **–ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ IP-–∞–¥—Ä–µ—Å–∞**: –ï—Å–ª–∏ –æ–¥–∏–Ω –∏ —Ç–æ—Ç –∂–µ IP –ø—Ä–µ–≤—ã—Å–∏–ª –∑–∞–¥–∞–Ω–Ω—ã–π –ª–∏–º–∏—Ç –æ—à–∏–±–æ–∫ –∑–∞ –∫–æ—Ä–æ—Ç–∫–∏–π –ø—Ä–æ–º–µ–∂—É—Ç–æ–∫ –≤—Ä–µ–º–µ–Ω–∏, Fail2Ban –¥–æ–±–∞–≤–ª—è–µ—Ç –µ–≥–æ –≤ –±–ª–æ–∫–∏—Ä–æ–≤–∫—É —á–µ—Ä–µ–∑ `iptables`, `nftables`, `firewalld`, `ipset` –∏–ª–∏ –¥—Ä—É–≥–æ–π backend-—Ñ–∏–ª—å—Ç—Ä.
    
4. **–†–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∫–∞**: –ß–µ—Ä–µ–∑ –∑–∞–¥–∞–Ω–Ω—ã–π –∏–Ω—Ç–µ—Ä–≤–∞–ª IP –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Ä–∞–∑–±–ª–æ–∫–∏—Ä—É–µ—Ç—Å—è, –µ—Å–ª–∏ –Ω–µ –±—ã–ª–æ –Ω–æ–≤—ã—Ö –Ω–∞—Ä—É—à–µ–Ω–∏–π.
#### üîê –ü—Ä–∏–º–µ—Ä –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è:
- –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –ø–µ—Ä–µ–±–æ—Ä–∞ –ø–∞—Ä–æ–ª–µ–π –Ω–∞ –ø–æ—á—Ç–æ–≤–æ–º —Å–µ—Ä–≤–µ—Ä–µ Zimbra —á–µ—Ä–µ–∑ –∞–Ω–∞–ª–∏–∑ `mailbox.log`.
- –ó–∞—â–∏—Ç–∞ SSH, FTP, SMTP, Apache/Nginx –∏ –¥—Ä—É–≥–∏—Ö —Å–µ—Ä–≤–∏—Å–æ–≤.

#### üìÅ –û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:

- **Jail** ‚Äì –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç, –∫–∞–∫–æ–π –ª–æ–≥-—Ñ–∞–π–ª –ø—Ä–æ–≤–µ—Ä—è—Ç—å, –∫–∞–∫–æ–µ –ø—Ä–∞–≤–∏–ª–æ –ø—Ä–∏–º–µ–Ω—è—Ç—å, –∏ –∫–∞–∫–∏–µ –¥–µ–π—Å—Ç–≤–∏—è –ø—Ä–µ–¥–ø—Ä–∏–Ω–∏–º–∞—Ç—å.
    
- **Filter** ‚Äì —Ä–µ–≥—É–ª—è—Ä–Ω–æ–µ –≤—ã—Ä–∞–∂–µ–Ω–∏–µ, –æ–ø–∏—Å—ã–≤–∞—é—â–µ–µ —à–∞–±–ª–æ–Ω "–ø–ª–æ—Ö–æ–π" –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –≤ –ª–æ–≥–µ.
    
- **Action** ‚Äì –∫–æ–º–∞–Ω–¥–∞, –∫–æ—Ç–æ—Ä—É—é –≤—ã–ø–æ–ª–Ω–∏—Ç—å –ø—Ä–∏ —Å—Ä–∞–±–∞—Ç—ã–≤–∞–Ω–∏–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, `iptables`-–±–∞–Ω IP).
### –£—Å—Ç–∞–Ω–æ–≤–∫–∞
```
apt update && apt upgrade -y && apt install fail2ban -y && systemctl enable fail2ban
```
### –õ–æ–≥–∏
`tail -f /var/log/fail2ban.log `# –û—Å–Ω–æ–≤–Ω–æ–π –ª–æ–≥
`journalctl -u fail2ban --no-pager` ¬† ¬†# –õ–æ–≥ —á–µ—Ä–µ–∑ systemd (–µ—Å–ª–∏ –Ω–µ—Ç –ø—Ä–∞–≤ –Ω–∞ —Ñ–∞–π–ª) ¬†
### –ö–æ–º–∞–Ω–¥—ã
`systemctl start fail2ban` # –ó–∞–ø—É—Å—Ç–∏—Ç—å fail2ban
`systemctl stop fail2ban` ¬†# –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å fail2ban 
`systemctl restart fail2ban` # –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å fail2ban
`fail2ban-client -t` # –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –Ω–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å
`fail2ban-client status` # –ü–æ–∫–∞–∑–∞—Ç—å –∞–∫—Ç–∏–≤–Ω—ã–µ —Ç—é—Ä—å–º—ã (jails)
`fail2ban-client status <jail>` ¬†# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π —Ç—é—Ä—å–º—ã (–Ω–∞–ø—Ä–∏–º–µ—Ä, sshd)
`fail2ban-client ping` # –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —Ä–∞–±–æ—Ç–∞–µ—Ç –ª–∏ fail2ban (–¥–æ–ª–∂–µ–Ω –æ—Ç–≤–µ—Ç–∏—Ç—å pong)
`fail2ban-client --version` ¬†# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤–µ—Ä—Å–∏—é fail2ban
`fail2ban-client set <jail> banip <IP>` ¬†# –ó–∞–±–∞–Ω–∏—Ç—å IP –≤—Ä—É—á–Ω—É—é
`fail2ban-client set <jail> unbanip <IP>` ¬†# –†–∞–∑–±–∞–Ω–∏—Ç—å IP   *jail* - –Ω–∞–∑–≤–∞–Ω–∏–µ —Ç—é—Ä—å–º—ã
